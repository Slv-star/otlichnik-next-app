<... truncated full code from canvas ...>